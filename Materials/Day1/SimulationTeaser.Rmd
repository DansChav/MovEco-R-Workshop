---
title: "Simulation Teaser"
author: "Dana"
date: "12/6/2017"
output: github_document
---

# A Teaser: Simulation
A combination of the ideas introduced here form the basis of all basic simulations. 
Although we will go into simulation construction in much more depth later in the workshop,
just to see how all these parts fit together, let's run through a very basic 
simulation. 

## Step 1:  Defining the model

Perhaps we want to simulate the growth of the classic lynx and hare populations through time. First, we 
need to construct our underlying growth equations using custom R functions:

For our simple purposes we'll ignore elements like search time and carrying capacity 
and define prey (H) and predator (P) growth as follows:

$$f(H,P) = a - b P $$

$$g(H,P) = c H  - d $$

These translate into the following R functions:
```{r}
prey <- function(H, P, pars){  # pars here refers to a list of all our starting parameters values I will introduce later
 (pars$a - pars$b*P)          # note the dollar sign - this is a way from baseR to select a named object in a vector
}
pred <- function(H, P, pars){
  (pars$c*H - pars$d)
}
```


## Step 2: Initialize

Before we can simulate our populations through time we have to establish some
starting values for our parameters: a,b,c,d, H0 (initial prey population), and
P0 (intial predator population). 

We can (but certainly don't have to) put our intial values into a named list to make it easy to keep track of them:
```{r}
inits <- list(H0 = 1.1, P0 = 1.1, a = .01, b = .01, c = .01, d = .01)
```

## Step 3: Simulate

Now to simulate population levels through tiwe need to loop over equations that 
take the value of a given population at time t and at it to the change in the popualtion
over a given time step, e.g.:

$$H_{t+1} = H_t + H_t  f(H,P) $$

$$P_{t+1} = P_t + P_t  g(H,P) $$

A basic simulation is just a complex custom function containing 3 steps: 
1. initialize: initialize your vectors so that the for loop knows where to start and has place to store output. 
2. iterate: run your loop!
3. output: return your results!

Take a look at how I have labeled them throughout the following simulation.

Just like our custom functions above, this simulation needs to take several arguments
namely:

- the number of iterations we want to run for
- a list of parameters and initial values for our models 
- our predator growth function
- our prey growth function

```{r}
sim <- function(pars = inits, t = 500,  g = pred, f = prey){ #note that I have given each of my arguments defaults
  
  # initialize
  H <- numeric(t)  # makes a blank vector of length t
  P <- numeric(t)
  H[1] <- pars$H0  # places our initial population value
  P[1] <- pars$P0
  
  # iterate
  for(i in 1:(t-1)){
      H[i+1] <- (1 + f(H[i], P[i], pars)) * H[i]
      P[i+1] <- (1 + g(H[i], P[i], pars)) * P[i]
  }
  
  # output
  data.frame(time = 1:t, hare = H, lynx = P)
}


#
sim() %>% 
  gather(key= species, value = population, -time) %>%  # melt the data so that there is a unique row for each species population at each time. 
  ggplot(aes(x=time, y = population,  group=species)) + geom_line()

```

Congrats: it's that simple and you've just run your first simulation! 
If you're curious, play around with the initial values and try plotting
your results. 

Much more simulation practice to come next week!