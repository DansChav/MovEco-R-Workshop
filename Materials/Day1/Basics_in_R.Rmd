---
title: "Basics in R"
author: "Dana Seidel & Eric Dougherty"
date: "1/3/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
#library("printr") ## devtools::install_github("yihui/printr")
```


# Introducing R studio
- What is the console? 
- What is the source?
- what is your environment?
- Using git within Rstudio


# The TidyVerse

The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying philosophy and common APIs. 

Install the packages: `install.packages("tidyverse")`

Access the book! [R for Data Science](http://r4ds.had.co.nz/)

Other Resources:
- [Cheat sheets!](https://www.rstudio.com/resources/cheatsheets/)
- [More Books & online courses](https://www.tidyverse.org/learn/)

# Importing Data

> In Data Science, 80% of time spent prepare data, 20% of time spent complain about need for prepare data. 

Big Data Borat [@BigDataBorat](https://twitter.com/BigDataBorat/status/306596352991830016), February 27, 2013

## Parsing

Our first task is to read this data into our R environment.  To this, we will use the `read_csv` function. Reading in a data file is called *parsing*, which sounds much more sophisticated.  For good reason too -- parsing different data files and formats is a cornerstone of all pratical data science research, and can often be the hardest step.

#### So what do we need to know about this file in order to read it into R?

```{r, message=FALSE}
library("tidyverse")
```


```{r}
## Let's try:
co2 <- read_table("ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt")
co2
```


**hmm... no luck.  Let's try defining the comment symbol:**

```{r }
co2 <- read_tsv("ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt",
                comment = "#")
co2
```

Getting there, but not quite done. Our first row is being interpreted as column names.  The documentation also notes that certain values are used to indicate missing data, which we would be better off converting to explicitly missing so we don't get confused.


```{r}
co2 <- read.table("ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt",
                  sep = "", comment = "#",
                  col.names = c("year", "month", "decimal_date", 
                                "average", "interpolated", 
                                "trend", "days"),
                  na.strings = c("-1", "-99.99"))
head(co2)
```


## Importing Data with tidyverse

Alternately, with `readr::read_table` from `tidyverse` 

It seems that `comment` arg is not fully implemented in CRAN version of `readr` so we must rely on `skip` to avoid the comment block:

```{r message=FALSE, warning=FALSE}
co2 <- read_table("ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt",
                  col_names = c("year", "month", "decimal_date", 
                                "average", "interpolated", "trend", "days"),
                  col_types = c("iiddddi"),
                  na = c("-1", "-99.99"),
                  skip = 72)

co2
```

Success! We have read in the data. Now we're ready to rock and roll.

# Viewing data

Once parsed and imported, it's a good idea to take a look at your data, both to 
get a sense of it's size, names, and shape but also to keep an eye out for missing
value or errors. 

For this stage, using a combination of `str`, `names`, `summar`, `View`, `head` and `tail`
functions can be helpful. 

```{r}
# to get the names of the columns
names(co2)

# to check out the full structure of the R object
str(co2)
nrow(co2)
ncol(co2)

# to get a summary of the object
summary(co2)  # here we can get a good sense of the missing values in the days column and average column. 

# for the first or last `n` lines of the data frame
head(co2) # check out r help - shows us that the default argument is 10 lines
tail(co2, 20)

# to see the whole table in a Rstudio window
View(co2)
# also double click from the environment
```

# Subsetting data

Subsetting can be done a variety of ways through baseR and tidyverse. Here we are going
to cover the following ways:
- `select()`, tidyverse
- `filter()` , tidyverse
- bracket `[]` notation, baseR
- dollar sign `$` notation, baseR
- subset function, baseR

```{r}
co2[,"year"] 
co2[,1]
co2$year  # what's the difference here?


co2 %>% select(year, average) 
co2[, c("year", "average")] 
co2[, c(1,4)]

co2 %>% select(-days)# select all columns except year
co2[,-7]
co2 %>% filter(year >= 1980, month == 12) # comma functions as "and" in the filter function
co2 %>% subset(year >= 1980 & month == 12)  # but and must be explicit in the subset function

co2 %>% filter(month == 11 | month == 11) # | is equivalent to "or"

co2[co2$month==12,] 
co2[co2$year>=1980 & co2$month==12,]
co2[co2$month==12 | co2$month==11,] 

# Note: logical operations (those that produce True or False) require the double equal sign `==`
```

### SideNote: Whats that little `c()` do?
Try running `?c` in your R console to find out. We use this function regularly
to create vectors or lists of objects. 

### SideNote: The Power of the Pipe `%>%`
You might be thinking what is that weird symbol we just used? 
This is a pipe, a function in the `magittr` package loaded in the tidyverse, 
Pipes are a powerful way
to perform sequential operations on an R object. Using the pipe, allows use to push 
the output of our first operation into our next operation seamlessly, without using
intermediate objects or overwriting our original object. 

```{r}
co2 %>% 
  filter(year >= 1980, month == 12) %>%
  select(year, average)

# This is the same but much more readable and much cleaner than the following:

co2_filter <- filter(co2, year >= 1980, month == 12)
co2_subset <- select(co2_filter, year, average)
co2_subset
```
It's also worth noting that the piped version does not create an additional object unless you ask it to. 
This is super useful in the early stages of exploring and visualizing your data.

More information about pipes and the alternatives found [here](http://r4ds.had.co.nz/pipes.html)

# Sorting data
## Mutating
```{r}

```

## GroupBy
```{r}

```

## summarizing data
```{r}

```

# Plotting data
## Plotting Data with `ggplot`

Effective visualizations are an integral part of data science, poorly organized or poorly labelled figures can be as much a source of peril as understanding.  Nevertheless, the ability to generate plots quickly with minimal tinkering is an essential skill.  As standards for visualizations have increased, too often visualization is seen as an ends rather than a means of data analysis. See [Fox & Hendler (2011)](http://science.sciencemag.org/content/331/6018/705.short) for more discussion of this.

## Plotting Data with `ggplot`


```{r}
ggplot(co2, aes(decimal_date, average)) + geom_line()
```


## Plotting multiple series

We often would like to plot several data values together for comparison,
for example the average, interpolated and trend co2 data. We can do
this in three steps:

1) subsetting the dataset to the columns desired for plotting

```{r}
co2_sub <- co2 %>%
    select(decimal_date, average, interpolated, trend)
co2_sub %>% head()
```


2) rearranging the data into a "long" data table where the data values
are stacked together in one column and there is a separate column that
keeps track of the whether the data came from the average,
interpolated, or trend column. Notice by using the same name,
we overwrite the original co2_sub


```{r}
co2_sub <- co2_sub %>%
    gather(series, ppmv, -decimal_date)
co2_sub %>% head()
```

3)


# Writing out Data or objects
